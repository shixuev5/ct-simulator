需求：

通过支持 modbus 协议的三相智能电表，采集三相的总有功功率以及L1相的电压数据，通过 RS485 协议传输给 CT 模拟器。CT 模拟器将根据总有功功率以及L1相电压计算出需要模拟的L1相电流，模拟的CT变比为2000，意味着L1相100A电流 CT 模拟器最后输出给逆变器CT端口为 50 mA的电流。注意：仅仅是在L1上模拟三相的电流，用于电网双向电表计费时能进行补偿，L1相上并联储能逆变器，储能逆变器根据CT 模拟器输出的电流反向计算出出口处的总有功功率进行充放电。

实现：

1. RS485转TTL
2. 220v过零检测模块
3. ESP32 单片机
4. MCP4725 12-bit DAC 输出 0-5V正弦波
5. 正负 12 V电源
6. 3.3、5V 输出电源
7. OPA2134PA 功放 输出正负5v正弦波
8. LM4040A-2.5 输出 2.5v 基准电压
9. BD139、BD140、2 x 1N4148 输出正负 50mA 正弦波电流
10. 0.1uf电容、10K、20K欧电阻、100欧电阻等


ESP32代码编写：

过零检测输出接在GPIO4，RS485转TTL模块输出接在 GPI16、GPI17

编写代码先固定从RS485转TTL模块读取的寄存器地址返回总有功功率为11kw，L1相电压为220v。这意味着最终电路输出的电流应该是25mA。